
<div class="flex flex-wrap text-4xl lg:text-lg">
  <div class="card bg-gray-300">
    <div class="py-2">
      <%= @total_tasks %> tasks (<%= @tasks.length %> shown)
    </div>

    <div class="py-2">
      <% if @filters %>
        Filters:

        <% @filters.each do |filter| %>
          <% if filter.start_with?('+') %>
            <span class="tag-pill text-green-700 bg-green-100">
              <%= filter %>
            </span>
          <% elsif filter.start_with?('@') %>
            <span class="tag-pill text-blue-700 bg-blue-100">
              <%= filter %>
            </span>
          <% end %>
        <% end %>

        <span class="text-3xl lg:text-sm">
          <% if @filters.empty? %>
            (None)
          <% else %>
            <%= link_to 'Clear', root_url, class: 'text-blue-800 hover:opacity-50' %>
          <% end %>
        </span>
      <% end %>
    </div>
  </div>

  <% @tasks.each do |task| %>
    <div class="card flex flex-col justify-between <%= priority_background_class(task) %>">
      <div>
        <div class="float-right px-1 py-2 text-gray-600">
          <% task.tags.each do |tag, value| %>
            <span class="px-1">
              <%= tag %>:<%= value %>
            </span>
          <% end %>
          <span class="font-semibold <%= priority_text_class(task) %>">
            <%= task.priority %>
          </span>
        </div>

        <div class="px-2 py-2">
          <p class="text-gray-900">
            <%= auto_link(task.text) %>
          </p>
        </div>

        <div class="px-2">
          <% task.projects.each do |project| %>
            <%= link_to project,
              root_url(filters: (@filters + [project]).uniq),
              class: 'tag-pill text-green-700 bg-green-100'
            %>
          <% end %>

          <% task.contexts.each do |context| %>
            <%= link_to context,
              root_url(filters: (@filters + [context]).uniq),
              class: 'tag-pill text-blue-700 bg-blue-100'
            %>
          <% end %>
        </div>
      </div>

      <div class="flex justify-between">
        <span class="px-2 py-1 text-gray-600 self-end">
          <%= task.created_on %>
        </span>

        <%# XXX Sort out icon sizing inconsistencies in below %>
        <span>
          <%= button_to(
            tasks_path,
            {
              method: :delete,
              data: {confirm: 'Are you sure you want to delete this task?'},
              params: {task: task.raw.strip},
              class: 'rounded hover:opacity-50 focus:opacity-50 focus:shadow-outline',
              form_class: 'px-1 inline-block'
            }
          ) do %>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              class="fill-current h-12 w-12">
              <path
                class="text-gray-500"
                d="M5 5h14l-.89 15.12a2 2 0 0 1-2 1.88H7.9a2 2 0 0 1-2-1.88L5 5zm5 5a1 1 0 0 0-1 1v6a1 1 0 0 0 2 0v-6a1 1 0 0 0-1-1zm4 0a1 1 0 0 0-1 1v6a1 1 0 0 0 2 0v-6a1 1 0 0 0-1-1z"
              />
              <path
                class="text-gray-600"
                d="M8.59 4l1.7-1.7A1 1 0 0 1 11 2h2a1 1 0 0 1 .7.3L15.42 4H19a1 1 0 0 1 0 2H5a1 1 0 1 1 0-2h3.59z"
              />
            </svg>
          <% end %>

          <%= button_to(
            complete_tasks_path,
            {
              params: {task: task.raw.strip},
              class: 'rounded hover:opacity-50 focus:opacity-50 focus:shadow-outline',
              form_class: 'px-1 inline-block'
            }
          ) do %>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              class="fill-current text-green-600 h-12 w-12"
              >
              <path d="M10 14.59l6.3-6.3a1 1 0 0 1 1.4 1.42l-7 7a1 1 0 0 1-1.4 0l-3-3a1 1 0 0 1 1.4-1.42l2.3 2.3z"/>
            </svg>
          <% end %>
        </span>

      </div>
    </div>
  <% end %>
</div>
